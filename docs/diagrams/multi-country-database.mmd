%%{init: {
  'theme': 'base',
  'themeVariables': {
    'primaryColor': '#1f77b4',
    'primaryTextColor': '#000000',
    'primaryBorderColor': '#0d47a1',
    'lineColor': '#ff7f0e',
    'secondaryColor': '#2ca02c',
    'tertiaryColor': '#d62728',
    'background': '#ffffff',
    'mainBkg': '#f8f9fa',
    'secondBkg': '#e9ecef',
    'tertiaryBkg': '#dee2e6',
    'nodeBkg': '#ffffff',
    'nodeBorder': '#1f77b4',
    'clusterBkg': '#f0f8ff',
    'clusterBorder': '#4A90E2',
    'defaultLinkColor': '#ff7f0e',
    'titleColor': '#0d47a1',
    'textColor': '#000000',
    'nodeTextColor': '#000000',
    'clusterTextColor': '#000000'
  },
  'flowchart': {
    'nodeSpacing': 50,
    'rankSpacing': 80,
    'curve': 'basis',
    'padding': 20,
    'useMaxWidth': true,
    'htmlLabels': true
  },
  'fontFamily': 'Arial, sans-serif',
  'fontSize': 14,
  'fontWeight': 'normal'
}}%%
graph TB
    subgraph GLOBAL["ğŸŒ GLOBAL LOAD BALANCER"]
        GLOBAL_LB["<b>âš–ï¸ Global Load Balancer</b><br/><i>AWS CloudFront</i>"]
        DNS["<b>ğŸŒ DNS with Geo-routing</b><br/><i>Route 53</i>"]
    end
    
    subgraph US["ğŸ‡ºğŸ‡¸ UNITED STATES"]
        subgraph US_EAST["ğŸ“ US-East (Virginia)"]
            US_API1["ğŸŒ API Gateway US-East<br/>Port: 3001"]
            US_DB_MASTER[("ğŸ˜ PostgreSQL Master<br/>Port: 5432")]
            US_DB_SLAVE1[("ğŸ˜ PostgreSQL Slave 1<br/>Port: 5433")]
            US_REDIS1[("ğŸ”´ Redis Cluster<br/>Port: 6379")]
            US_ES1[("ğŸ” Elasticsearch<br/>Port: 9200")]
        end
        
        subgraph US_WEST["ğŸ“ US-West (Oregon)"]
            US_API2["ğŸŒ API Gateway US-West<br/>Port: 3001"]
            US_DB_SLAVE2[("ğŸ˜ PostgreSQL Slave 2<br/>Port: 5433")]
            US_REDIS2[("ğŸ”´ Redis Cluster<br/>Port: 6379")]
            US_ES2[("ğŸ” Elasticsearch<br/>Port: 9200")]
        end
    end
    
    subgraph INDIA["ğŸ‡®ğŸ‡³ INDIA"]
        subgraph IN_MUMBAI["ğŸ“ Mumbai (ap-south-1)"]
            IN_API1["ğŸŒ API Gateway Mumbai<br/>Port: 3001"]
            IN_DB_MASTER[("ğŸ˜ PostgreSQL Master<br/>Port: 5432")]
            IN_DB_SLAVE1[("ğŸ˜ PostgreSQL Slave 1<br/>Port: 5433")]
            IN_REDIS1[("ğŸ”´ Redis Cluster<br/>Port: 6379")]
            IN_ES1[("ğŸ” Elasticsearch<br/>Port: 9200")]
        end
        
        subgraph IN_BANGALORE["ğŸ“ Bangalore (ap-southeast-1)"]
            IN_API2["ğŸŒ API Gateway Bangalore<br/>Port: 3001"]
            IN_DB_SLAVE2[("ğŸ˜ PostgreSQL Slave 2<br/>Port: 5433")]
            IN_REDIS2[("ğŸ”´ Redis Cluster<br/>Port: 6379")]
            IN_ES2[("ğŸ” Elasticsearch<br/>Port: 9200")]
        end
    end
    
    subgraph UK["ğŸ‡¬ğŸ‡§ UNITED KINGDOM"]
        subgraph UK_LONDON["ğŸ“ London (eu-west-2)"]
            UK_API1["ğŸŒ API Gateway London<br/>Port: 3001"]
            UK_DB_MASTER[("ğŸ˜ PostgreSQL Master<br/>Port: 5432")]
            UK_DB_SLAVE1[("ğŸ˜ PostgreSQL Slave 1<br/>Port: 5433")]
            UK_REDIS1[("ğŸ”´ Redis Cluster<br/>Port: 6379")]
            UK_ES1[("ğŸ” Elasticsearch<br/>Port: 9200")]
        end
    end
    
    subgraph GLOBAL_SERVICES["ğŸŒ GLOBAL SERVICES"]
        GLOBAL_CONFIG["âš™ï¸ Global Configuration<br/>Consul/etcd"]
        GLOBAL_ANALYTICS["ğŸ“Š Global Analytics<br/>Data Warehouse"]
        GLOBAL_MONITORING["ğŸ“ˆ Global Monitoring<br/>Prometheus/Grafana"]
        CROSS_COUNTRY_SYNC["ğŸ”„ Cross-Country Sync<br/>EventBridge"]
    end
    
    subgraph REPLICATION["ğŸ”„ DATA REPLICATION"]
        US_REPLICATION["ğŸ“¤ US Data Replication<br/>WAL Streaming"]
        IN_REPLICATION["ğŸ“¤ India Data Replication<br/>WAL Streaming"]
        UK_REPLICATION["ğŸ“¤ UK Data Replication<br/>WAL Streaming"]
        GLOBAL_SYNC["ğŸŒ Global Data Sync<br/>Kafka/EventBridge"]
    end
    
    %% Global routing
    DNS -->|"Geo-routing"| GLOBAL_LB
    GLOBAL_LB -->|"US Traffic"| US_API1
    GLOBAL_LB -->|"US Traffic"| US_API2
    GLOBAL_LB -->|"India Traffic"| IN_API1
    GLOBAL_LB -->|"India Traffic"| IN_API2
    GLOBAL_LB -->|"UK Traffic"| UK_API1
    
    %% US connections
    US_API1 -->|"Primary"| US_DB_MASTER
    US_API2 -->|"Read Replica"| US_DB_SLAVE2
    US_DB_MASTER -->|"Streaming Replication"| US_DB_SLAVE1
    US_DB_MASTER -->|"Streaming Replication"| US_DB_SLAVE2
    
    %% India connections
    IN_API1 -->|"Primary"| IN_DB_MASTER
    IN_API2 -->|"Read Replica"| IN_DB_SLAVE2
    IN_DB_MASTER -->|"Streaming Replication"| IN_DB_SLAVE1
    IN_DB_MASTER -->|"Streaming Replication"| IN_DB_SLAVE2
    
    %% UK connections
    UK_API1 -->|"Primary"| UK_DB_MASTER
    UK_DB_MASTER -->|"Streaming Replication"| UK_DB_SLAVE1
    
    %% Cross-country replication
    US_DB_MASTER -->|"Encrypted WAL"| US_REPLICATION
    IN_DB_MASTER -->|"Encrypted WAL"| IN_REPLICATION
    UK_DB_MASTER -->|"Encrypted WAL"| UK_REPLICATION
    
    US_REPLICATION -->|"Event Streaming"| GLOBAL_SYNC
    IN_REPLICATION -->|"Event Streaming"| GLOBAL_SYNC
    UK_REPLICATION -->|"Event Streaming"| GLOBAL_SYNC
    
    GLOBAL_SYNC -->|"Aggregated Data"| GLOBAL_ANALYTICS
    GLOBAL_SYNC -->|"Health Metrics"| GLOBAL_MONITORING
