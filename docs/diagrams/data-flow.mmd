%%{init: {
  'theme': 'base',
  'themeVariables': {
    'primaryColor': '#1f77b4',
    'primaryTextColor': '#000000',
    'primaryBorderColor': '#0d47a1',
    'lineColor': '#ff7f0e',
    'secondaryColor': '#2ca02c',
    'tertiaryColor': '#d62728',
    'background': '#ffffff',
    'mainBkg': '#f8f9fa',
    'secondBkg': '#e9ecef',
    'tertiaryBkg': '#dee2e6',
    'actorBkg': '#ffffff',
    'actorBorder': '#1f77b4',
    'actorTextColor': '#000000',
    'actorLineColor': '#1f77b4',
    'signalColor': '#ff7f0e',
    'signalTextColor': '#000000',
    'labelBoxBkgColor': '#ffffff',
    'labelBoxBorderColor': '#1f77b4',
    'labelTextColor': '#000000',
    'loopTextColor': '#000000',
    'activationBkgColor': '#2ca02c',
    'activationBorderColor': '#1f77b4',
    'textColor': '#000000',
    'noteBkgColor': '#fff2cc',
    'noteBorderColor': '#F5A623',
    'noteTextColor': '#000000'
  },
  'sequence': {
    'diagramMarginX': 80,
    'diagramMarginY': 30,
    'actorMargin': 80,
    'width': 200,
    'height': 90,
    'boxMargin': 20,
    'boxTextMargin': 12,
    'noteMargin': 20,
    'messageMargin': 50,
    'mirrorActors': true,
    'bottomMarginAdj': 1,
    'useMaxWidth': true,
    'rightAngles': false,
    'showSequenceNumbers': false
  },
  'fontFamily': 'Segoe UI, Arial, sans-serif',
  'fontSize': 18,
  'fontWeight': '600'
}}%%
sequenceDiagram
    participant C as <b>👤 Customer</b>
    participant API as <b>🌐 API Gateway</b>
    participant AUTH as <b>🔐 Auth Service</b>
    participant ORDER as <b>📦 Order Service</b>
    participant PAYMENT as <b>💳 Payment Service</b>
    participant DELIVERY as <b>🚚 Delivery Service</b>
    participant DB as <b>🐘 PostgreSQL</b>
    participant CACHE as <b>🔴 Redis</b>
    participant SEARCH as <b>🔎 Elasticsearch</b>
    
    Note over C,SEARCH: <b>📋 ORDER CREATION FLOW</b>
    
    C->>+API: <b>📝 Create Order Request</b><br/><span style='color:#666;font-size:14px'>POST /api/v4/orders</span>
    API->>+AUTH: <b>🔍 Validate JWT Token</b>
    AUTH->>+CACHE: <b>🔑 Check User Session</b>
    CACHE-->>-AUTH: <b>✅ Session Valid</b>
    AUTH-->>-API: <b>✅ Token Valid</b>
    
    API->>+ORDER: <b>📦 Process Order Request</b>
    ORDER->>+DB: <b>💾 Save Order Data</b>
    DB-->>-ORDER: <b>✅ Order Saved</b>
    ORDER->>+DB: <b>💾 Save Order Items</b>
    DB-->>-ORDER: <b>✅ Items Saved</b>
    ORDER->>+CACHE: <b>⚡ Cache Order Data</b>
    CACHE-->>-ORDER: <b>✅ Data Cached</b>
    ORDER->>+SEARCH: <b>🔍 Index Order for Search</b>
    SEARCH-->>-ORDER: <b>✅ Order Indexed</b>
    ORDER-->>-API: <b>✅ Order Created Successfully</b>
    
    API->>+PAYMENT: <b>💳 Process Payment</b>
    PAYMENT->>+DB: <b>💾 Save Payment Record</b>
    DB-->>-PAYMENT: <b>✅ Payment Saved</b>
    PAYMENT->>+CACHE: <b>⚡ Cache Payment Status</b>
    CACHE-->>-PAYMENT: <b>✅ Status Cached</b>
    PAYMENT-->>-API: <b>✅ Payment Processed</b>
    
    API->>+DELIVERY: <b>🚚 Assign Delivery Partner</b>
    DELIVERY->>+DB: <b>💾 Update Order Status</b>
    DB-->>-DELIVERY: <b>✅ Status Updated</b>
    DELIVERY->>+CACHE: <b>⚡ Update Real-time Status</b>
    CACHE-->>-DELIVERY: <b>✅ Status Updated</b>
    DELIVERY-->>-API: <b>✅ Delivery Assigned</b>
    
    API-->>-C: <b>🎉 Order Confirmation</b><br/><span style='color:#666;font-size:14px'>Order ID: #12345</span>
