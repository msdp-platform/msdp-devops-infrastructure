%%{init: {'theme':'base', 'themeVariables': { 'primaryColor': '#d32f2f', 'primaryTextColor': '#fff', 'primaryBorderColor': '#b71c1c', 'lineColor': '#ff9800', 'secondaryColor': '#1976d2', 'tertiaryColor': '#388e3c'}}}%%
graph TB
    subgraph CLIENT_LAYER["🖥️ CLIENT LAYER"]
        CLIENT["📱 Client Applications<br/>Mobile & Web"]
        API_GW["🌐 API Gateway<br/>Rate Limiting & CORS"]
        AUTH_SVC["🔐 Authentication Service<br/>JWT & OAuth2"]
    end
    
    subgraph SECURITY_LAYER["🔒 SECURITY LAYER"]
        subgraph ACCESS_CONTROL["🛡️ ACCESS CONTROL"]
            RBAC["👥 Role-Based Access Control<br/>RBAC Matrix"]
            RLS["🔐 Row Level Security<br/>Data Isolation"]
            PERMISSIONS["📋 Permission Matrix<br/>Granular Permissions"]
        end
        
        subgraph DATA_PROTECTION["🔐 DATA PROTECTION"]
            ENCRYPTION["🔒 Data Encryption<br/>AES-256 at Rest"]
            HASHING["🔑 Password Hashing<br/>bcrypt + Salt"]
            AUDIT["📝 Audit Trail<br/>Complete Activity Log"]
        end
        
        subgraph NETWORK_SECURITY["🌐 NETWORK SECURITY"]
            TLS["🔐 TLS 1.3<br/>End-to-End Encryption"]
            VPN["🔒 VPN Access<br/>Private Network"]
            FIREWALL["🔥 Database Firewall<br/>IP Whitelisting"]
        end
    end
    
    subgraph DATABASE_LAYER["🗄️ DATABASE LAYER"]
        POSTGRES[("🐘 PostgreSQL<br/>Encrypted Storage")]
        REDIS[("🔴 Redis<br/>Encrypted Cache")]
        ELASTIC[("🔎 Elasticsearch<br/>Encrypted Search")]
    end
    
    subgraph MONITORING_LAYER["📊 MONITORING & COMPLIANCE"]
        LOGGING["📝 Security Logging<br/>SIEM Integration"]
        MONITORING["📈 Real-time Monitoring<br/>Anomaly Detection"]
        COMPLIANCE["✅ Compliance Checks<br/>GDPR, CCPA, SOX"]
    end
    
    %% Client to Security Flow
    CLIENT -->|"HTTPS"| API_GW
    API_GW -->|"JWT Validation"| AUTH_SVC
    AUTH_SVC -->|"Role Check"| RBAC
    RBAC -->|"Permission Check"| RLS
    RLS -->|"Data Access"| PERMISSIONS
    
    %% Network Security Flow
    API_GW -->|"TLS 1.3"| TLS
    TLS -->|"Encrypted Connection"| FIREWALL
    FIREWALL -->|"Filtered Access"| POSTGRES
    
    %% Data Protection Flow
    POSTGRES -->|"Encrypt Data"| ENCRYPTION
    POSTGRES -->|"Hash Passwords"| HASHING
    POSTGRES -->|"Log Activities"| AUDIT
    
    %% Monitoring Flow
    AUDIT -->|"Security Events"| LOGGING
    LOGGING -->|"Real-time Alerts"| MONITORING
    MONITORING -->|"Compliance Reports"| COMPLIANCE
