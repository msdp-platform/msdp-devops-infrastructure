%%{init: {
  'theme': 'base',
  'themeVariables': {
    'primaryColor': '#2E8B57',
    'primaryTextColor': '#000000',
    'primaryBorderColor': '#1B5E20',
    'lineColor': '#FF6B35',
    'secondaryColor': '#4A90E2',
    'tertiaryColor': '#F5A623',
    'background': '#ffffff',
    'mainBkg': '#f8f9fa',
    'secondBkg': '#e9ecef',
    'tertiaryBkg': '#dee2e6',
    'nodeBkg': '#ffffff',
    'nodeBorder': '#2E8B57',
    'clusterBkg': '#f0f8ff',
    'clusterBorder': '#4A90E2',
    'defaultLinkColor': '#FF6B35',
    'titleColor': '#1B5E20',
    'textColor': '#000000',
    'nodeTextColor': '#000000',
    'clusterTextColor': '#000000'
  },
  'flowchart': {
    'nodeSpacing': 80,
    'rankSpacing': 120,
    'curve': 'basis',
    'padding': 35,
    'useMaxWidth': true,
    'htmlLabels': true,
    'diagramPadding': 30
  },
  'fontFamily': 'Segoe UI, Arial, sans-serif',
  'fontSize': 18,
  'fontWeight': '600'
}}%%
graph TB
    subgraph APP["ğŸ–¥ï¸ APPLICATION LAYER"]
        API["<b>ğŸŒ API Gateway</b><br/><span style='color:#666;font-size:14px'>Port: 3001</span>"]
        AUTH["<b>ğŸ” Authentication Service</b><br/><span style='color:#666;font-size:14px'>Port: 3002</span>"]
        ORDER["<b>ğŸ“¦ Order Service</b><br/><span style='color:#666;font-size:14px'>Port: 3003</span>"]
        PAYMENT["<b>ğŸ’³ Payment Service</b><br/><span style='color:#666;font-size:14px'>Port: 3004</span>"]
        DELIVERY["<b>ğŸšš Delivery Service</b><br/><span style='color:#666;font-size:14px'>Port: 3005</span>"]
        NOTIFICATION["<b>ğŸ“± Notification Service</b><br/><span style='color:#666;font-size:14px'>Port: 3006</span>"]
    end
    
    subgraph DB["ğŸ—„ï¸ DATABASE LAYER"]
        subgraph PRIMARY["ğŸ“Š PRIMARY DATABASE"]
            POSTGRES[("<b>ğŸ˜ PostgreSQL 15+</b><br/><span style='color:#666;font-size:14px'>with PostGIS</span><br/><span style='color:#666;font-size:14px'>Port: 5432</span>")]
            USERS["<b>ğŸ‘¥ Users & Roles</b>"]
            ORDERS["<b>ğŸ“‹ Orders & Items</b>"]
            MERCHANTS["<b>ğŸª Merchants & Products</b>"]
            LOCATIONS["<b>ğŸ“ Locations & Zones</b>"]
            PAYMENTS["<b>ğŸ’° Payments</b>"]
            TRACKING["<b>ğŸ“ Delivery Tracking</b>"]
            REVIEWS["<b>â­ Reviews & Ratings</b>"]
            NOTIFICATIONS["<b>ğŸ”” Notifications</b>"]
            ANALYTICS["<b>ğŸ“ˆ Analytics Events</b>"]
        end
        
        subgraph CACHE["âš¡ CACHE LAYER"]
            REDIS[("<b>ğŸ”´ Redis 7+</b><br/><span style='color:#666;font-size:14px'>Port: 6379</span>")]
            SESSIONS["<b>ğŸ”‘ User Sessions</b>"]
            CACHE_DATA["<b>ğŸ’¾ API Response Cache</b>"]
            REALTIME["<b>âš¡ Real-time Data</b>"]
            RATELIMIT["<b>ğŸš¦ Rate Limiting</b>"]
        end
        
        subgraph SEARCH["ğŸ” SEARCH ENGINE"]
            ELASTIC[("<b>ğŸ” Elasticsearch 8.8+</b><br/><span style='color:#666;font-size:14px'>Port: 9200</span>")]
            SEARCH_ORDERS["<b>ğŸ” Order Search</b>"]
            SEARCH_PRODUCTS["<b>ğŸ” Product Search</b>"]
            SEARCH_MERCHANTS["<b>ğŸ” Merchant Search</b>"]
            SEARCH_USERS["<b>ğŸ” User Search</b>"]
            SEARCH_ANALYTICS["<b>ğŸ” Analytics Search</b>"]
        end
    end
    
    subgraph EXTERNAL["ğŸŒ EXTERNAL SERVICES"]
        STRIPE["<b>ğŸ’³ Stripe Payment</b><br/><span style='color:#666;font-size:12px'>API</span>"]
        MAPS["<b>ğŸ—ºï¸ Google Maps</b><br/><span style='color:#666;font-size:12px'>API</span>"]
        SMS["<b>ğŸ“± Twilio SMS</b><br/><span style='color:#666;font-size:12px'>API</span>"]
        EMAIL["<b>ğŸ“§ SendGrid Email</b><br/><span style='color:#666;font-size:12px'>API</span>"]
    end
    
    %% Connections
    API -.->|"<b>HTTP/HTTPS</b>"| POSTGRES
    API -.->|"<b>Redis Protocol</b>"| REDIS
    API -.->|"<b>HTTP</b>"| ELASTIC
    
    AUTH -.->|"<b>SQL</b>"| POSTGRES
    AUTH -.->|"<b>Redis Protocol</b>"| REDIS
    
    ORDER -.->|"<b>SQL</b>"| POSTGRES
    ORDER -.->|"<b>Redis Protocol</b>"| REDIS
    ORDER -.->|"<b>HTTP</b>"| ELASTIC
    
    PAYMENT -.->|"<b>SQL</b>"| POSTGRES
    PAYMENT -.->|"<b>HTTPS</b>"| STRIPE
    
    DELIVERY -.->|"<b>SQL</b>"| POSTGRES
    DELIVERY -.->|"<b>HTTPS</b>"| MAPS
    
    NOTIFICATION -.->|"<b>SQL</b>"| POSTGRES
    NOTIFICATION -.->|"<b>HTTPS</b>"| SMS
    NOTIFICATION -.->|"<b>HTTPS</b>"| EMAIL
    
    %% Internal connections
    POSTGRES --> USERS
    POSTGRES --> ORDERS
    POSTGRES --> MERCHANTS
    POSTGRES --> LOCATIONS
    POSTGRES --> PAYMENTS
    POSTGRES --> TRACKING
    POSTGRES --> REVIEWS
    POSTGRES --> NOTIFICATIONS
    POSTGRES --> ANALYTICS
    
    REDIS --> SESSIONS
    REDIS --> CACHE_DATA
    REDIS --> REALTIME
    REDIS --> RATELIMIT
    
    ELASTIC --> SEARCH_ORDERS
    ELASTIC --> SEARCH_PRODUCTS
    ELASTIC --> SEARCH_MERCHANTS
    ELASTIC --> SEARCH_USERS
    ELASTIC --> SEARCH_ANALYTICS
